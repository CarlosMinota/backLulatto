package com.lulatto.services;

import java.sql.SQLException;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Service;

import com.lulatto.domain.Cliente;
import com.lulatto.domain.Compra;
import com.lulatto.domain.Envio;
import com.lulatto.dto.CompraDTO;
import com.lulatto.repository.ClienteRepository;
import com.lulatto.repository.CompraRepository;
import com.lulatto.repository.EnvioRespository;

@Service
@Scope("singleton")
public class CompraServiceImpl implements CompraService{
	
	@Autowired
	private CompraRepository compraRepository;
	
	@Autowired
	private ClienteRepository clienteRepository;
	
	@Autowired
	private EnvioRespository envioRepository;
	

	@Override
	public CompraDTO addCompra(CompraDTO compraDTO) throws SQLException {
		
		Compra compra = new Compra();
		
		Cliente cliente = null;
		Envio envio = null;
		
		compra.setPrecio(compraDTO.getPrecio());

		cliente = clienteRepository.findByIdCliente(compraDTO.getCliente());
		
		if (cliente == null) {
			throw new SQLException("El cliente no se ha podido encontrar");
		}
		
		compra.setCliente(cliente);
		
		envio = envioRepository.findByIdEnvio(compraDTO.getEnvio());
		
		if(envio == null) {
			throw new SQLException("El estado de envio no exite");
		}
		
		return compraDTO;
	}

}
